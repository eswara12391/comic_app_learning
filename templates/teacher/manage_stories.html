{% extends "base.html" %}

{% block title %}Manage Stories - Comic Learning App{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/teacher.css') }}">
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <h1><i class="fas fa-book"></i> My Stories</h1>
        <p>Create and manage your interactive comic stories</p>
    </div>
    <a href="{{ url_for('create_story') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Create New Story
    </a>
</div>

<div class="filters">
    <div class="filter-group">
        <input type="text" id="search-stories" placeholder="Search stories..." class="form-control">
    </div>
    <div class="filter-group">
        <select id="filter-status" class="form-control">
            <option value="">All Status</option>
            <option value="published">Published</option>
            <option value="draft">Draft</option>
        </select>
    </div>
</div>

{% if stories %}
<div class="stories-grid">
    {% for story in stories %}
    <div class="story-card">
        <div class="story-card-header">
            {% if story.cover_image %}
            <img src="{{ url_for('static', filename='uploads/stories/' + story.cover_image) }}" 
                 alt="{{ story.title }}" class="story-cover">
            {% else %}
            <div class="story-cover-placeholder">
                <i class="fas fa-book"></i>
            </div>
            {% endif %}
            
            <div class="story-badges">
                {% if story.is_published %}
                <span class="badge badge-success">Published</span>
                {% else %}
                <span class="badge badge-warning">Draft</span>
                {% endif %}
                <span class="badge badge-info">{{ story.page_count or 0 }} pages</span>
            </div>
        </div>
        
        <div class="story-card-body">
            <h3>{{ story.title }}</h3>
            <p class="story-description">{{ story.description[:150] }}{% if story.description|length > 150 %}...{% endif %}</p>
            
            <div class="story-stats">
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span>{{ story.student_count or 0 }} students</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-question-circle"></i>
                    <span>{{ story.quiz_attempts or 0 }} quiz attempts</span>
                </div>
            </div>
            
            <div class="story-meta">
                <small class="text-muted">
                    Created: {{ story.created_at.strftime('%Y-%m-%d') }}
                </small>
            </div>
        </div>
        
        <div class="story-card-footer">
            <div class="action-buttons">
                <a href="{{ url_for('view_story_details', story_id=story.id) }}" 
                   class="btn btn-sm btn-outline" title="View Details">
                    <i class="fas fa-eye"></i>
                </a>
                
                <a href="{{ url_for('create_quiz', story_id=story.id) }}" 
                   class="btn btn-sm btn-outline" title="Edit Quiz">
                    <i class="fas fa-question-circle"></i>
                </a>
                
                <form method="POST" action="{{ url_for('delete_story', story_id=story.id) }}" 
                      class="delete-form" onsubmit="return confirm('Are you sure you want to delete this story?');">
                    <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon">
        <i class="fas fa-book"></i>
    </div>
    <h3>No stories created yet</h3>
    <p>Start creating your first interactive comic story!</p>
    <a href="{{ url_for('create_story') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Create Your First Story
    </a>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-stories');
    const statusFilter = document.getElementById('filter-status');
    const storyCards = document.querySelectorAll('.story-card');
    
    function filterStories() {
        const searchTerm = searchInput.value.toLowerCase();
        const status = statusFilter.value;
        
        storyCards.forEach(card => {
            const title = card.querySelector('h3').textContent.toLowerCase();
            const isPublished = card.querySelector('.badge-success') !== null;
            
            let matchesSearch = title.includes(searchTerm);
            let matchesStatus = true;
            
            if (status === 'published') {
                matchesStatus = isPublished;
            } else if (status === 'draft') {
                matchesStatus = !isPublished;
            }
            
            if (matchesSearch && matchesStatus) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    searchInput.addEventListener('input', filterStories);
    statusFilter.addEventListener('change', filterStories);
});
</script>
{% endblock %}